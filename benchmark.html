<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Benchmark</title>
</head>
<body>

    <h3>
        Simple benchmark for parse, add a period and format a date with moment and js-joda
    </h3>

    <pre><div id="result"></div></pre>

    <script src="//cdn.jsdelivr.net/js-joda/0.3.9/js-joda.min.js"></script>
    <script src="//cdn.jsdelivr.net/momentjs/2.11.2/moment.min.js"></script>
    <script src="//cdn.jsdelivr.net/lodash/4.5.1/lodash.min.js"></script>
    <script src="//cdn.jsdelivr.net/benchmarkjs/2.1.0/benchmark.js"></script>
    <script type="application/javascript">

        function freezeClassesAndStaticClassProperties(JSJodaModule) {
            Object.getOwnPropertyNames(JSJodaModule).forEach(function (className){
                if (className.indexOf('_') === 0 || className[0] !== className[0].toUpperCase()){
                    return;
                }
                var JSJodaClass = JSJodaModule[className];
                if(Object.isFrozen(JSJodaClass)){
                    return;
                }
                Object.getOwnPropertyNames(JSJodaClass).forEach(function(classProp){
                    if(JSJodaClass[classProp] instanceof JSJodaClass){
                        // console.log('about to freeze static instance: ' + className + '.' + classProp);
                        Object.freeze(JSJodaClass[classProp]);
                    }
                });
                // console.log('about to freeze class: ' + className);
                Object.freeze(JSJodaClass);
            });

        }

        function performBenchmark() {
            var LocalDateTime = JSJoda.LocalDateTime;
            var LocalDate = JSJoda.LocalDate;


            function testMomentParseDateTime() {
            	return moment('2016-02-26T09:29:08.678');
            }

            function testJSJodaParseDateTime() {
            	return LocalDateTime.parse('2016-02-26T09:29:08.678');
            }

            function testMomentParseDate() {
            	return moment('2016-02-26');
            }

            function testJSJodaParseDate() {
            	return LocalDate.parse('2016-02-26');
            }

            var m = moment('2016-02-26T09:29:08');
            function testMomentPlus() {
                m = m.add(30, 'days').add(30, 'hours');
                return m;
            }

            var d = LocalDateTime.parse('2016-02-26T09:29:08');
            function testJSJodaPlus() {
                d = d.plusDays(30).plusHours(30);
                return d;
            }

            function logResult(){
                var resultStr = 'Fastest is ' + this.filter('fastest').map('name') + '\n';
                this.filter('successful').forEach(function (value) {
                    resultStr += 'Result for ' + value.name + '\n';
                    resultStr += JSON.stringify(_.pick(value, ['name', 'hz', 'count']), null, 4) + '\n';
                });
                console.log(resultStr)
                document.getElementById('result').textContent += resultStr;
            }

            function logFullResult(){
                console.log(JSON.stringify(this, null, 4));
            }

            var suite = new Benchmark.Suite();
            suite
            	.add('testMomentParseDateTime', testMomentParseDateTime)
            	.add('testJSJodaParseDateTime', testJSJodaParseDateTime)
            	.add('testMomentParseDate', testMomentParseDate)
            	.add('testJSJodaParseDate', testJSJodaParseDate)
            	.add('testMomentPlus', testMomentPlus)
            	.add('testJSJodaPlus', testJSJodaPlus)
            	.on('complete', logResult)
            	.run();

        }
        document.getElementById('result').textContent = '';
        performBenchmark();
        freezeClassesAndStaticClassProperties(JSJoda)
        performBenchmark();
    </script>

</body>
</html>